document.addEventListener('DOMContentLoaded', () => {
    const questions = [
        document.getElementById('question1'),
        document.getElementById('question2'),
        document.getElementById('question3')
    ];
    const quizSection = document.getElementById('quiz-section');
    const resultSection = document.getElementById('result-section');
    const songTitle = document.getElementById('song-title');
    const songDescription = document.getElementById('song-description');
    const songLinkContainer = document.getElementById('song-link-container');
    const restartBtn = document.getElementById('restart-btn');

    let currentQuestionIndex = 0;
    let answers = {}; // ユーザーの回答を保存するオブジェクト

    // おすすめ楽曲データ
    // YouTube埋め込みリンクは公式チャンネルの共有->埋め込みから取得してください
    // 例: <iframe width="560" height="315" src="https://www.youtube.com/embed/hogehoge" ...></iframe>
    // このsrc属性のURLを embed_url に設定します。
    const recommendations = {
        // 元気にノリたい x ロック x 前向き

        "up_rock_positive": {
            title: "インフェルノ",
            description: "力強いバンドサウンドと疾走感が魅力！アニメ主題歌としても大ヒットした、熱く燃え上がるような一曲です。気分を上げたい時にぴったり。",
            embed_url: "https://www.youtube.com/embed/n4f7_i2B7B0" // 例: インフェルノのYouTube埋め込みURL
        },
        // 元気にノりたい　×　ロック　×　深いメッセ
        "up_rock_deep": {
            title: "アウフヘーベン",
            description: ,
            embed_url:
        }
        // 元気にノりたい　×　ロック　×　恋愛
        "up_rock_love":
            title: "アウフヘーベン",
            description: ,
            embed_url:
        // 元気にノりたい　×　ロック　×　感動
        ニューマイノーマル
        // 元気にノリたい x ポップ x 前向き
        "up_pop_positive": {
            title: "青と夏",
            description: "夏をテーマにした、爽やかでキャッチーな代表曲。聴くと心が弾むような、青春のキラキラが詰まっています。",
            embed_url: "https://www.youtube.com/embed/mF3Q8X8zW1s" // 例: 青と夏のYouTube埋め込みURL
        },
        // 元気にノりたい　×　ポップ　×　深いメッセ
        ビターバカンス
        // 元気にノりたい　×　ポップ　×　恋愛
        ラブみーらぶゆー
        // 元気にノりたい　×　ポップ　×　感動
        鯨の歌
        // 元気にノりたい　×　バラード　×　前向き
        フィーリング
        // 元気にノりたい　×　バラード　×　深いメッセ
        絶世生物
        // 元気にノりたい　×　バラード　×　恋愛
        アンブレラ
        // 元気にノりたい　×　バラード　×　感動
        ソフトドリンク
        // 元気にノりたい　×　EDM　×　前向き
        ウォンテッド
        // 元気にノりたい　×　EDM ×　深いメッセ
        スマイロブドリーマ
        // 元気にノりたい　×　EDM ×　恋愛
        ジャストアフレンド
        // 元気にノりたい　×　EDM　×　感動
        サママフェスティバルｚ
        // しっとり　×　ロック　×　前向き
        橙
        // しっとり　×　ロック　×　深いメッセ
        嘘じゃないよ
        // しっとり　×　ロック　×　恋愛
        ハグ
        // しっとり　×　ロック　×　感動
        春愁
        // しっとり　×　ポップ　×　前向き
        ラビン
        // しっとり　×　ポップ　×　深いメッセ
        ケセラセラ
        // しっとり　×　ポップ　×　恋愛
        フロリジナル
        // しっとり　×　ポップ　×　感動
        ファミリア
        // しっとり　×　バラード　×　前向き
        フォークトーク
        // しっとり　×　バラード　×　深いメッセ
        ディアー
        // しっとり　×　バラード　×　恋愛
        点描の唄
        // しっとり　×　バラード　×　感動
        ナハトムジーク
        // しっとり　×　EDM　×　前向き
        チアーズ
        // しっとり　×　EDM　×　深いメッセ
        WHOO
        // しっとり　×　EDM　×　恋愛
        うブ
        // しっとり　×　EDM　×　感動
        リバース
        // いやな気分　×　ロック　×　前向き
        私は最強
        // いやな気分　×　ロック　×　深いメッセ
        アプリオリ
        // いやな気分　×　ロック　×　恋愛
        ロンリネス
        // いやな気分　×　ロック　×　感動
        おもちゃの兵隊
        // いやな気分　× ポップ　×　前向き
        アンラブレス
        // いやな気分　×　ポップ　×　深いメッセ
        ダンスホール
        // いやな気分　×　ポップ　×　恋愛
        ナンバー７
        // いやな気分　×　ポップ　×　感動
        アティチュード
        // いやな気分　×　バラード　×　前向き
        僕のこと
        // いやな気分　×　バラード　×　深いメッセ
        BFF
        // いやな気分　×　バラード　×　恋愛
        恋と吟かバイキング
        // いやな気分　×　バラード　×　感動
        そらんじ
        // いやな気分　×　EDM　×　前向き
        スプラッシュ
        // いやな気分　×　EDM　×　深いメッセ
        藍
        // いやな気分　×　EDM　×　恋愛
        L.P
        // いやな気分　×　EDM　×　感動
        ウォンテッド
        // 悲しい　×　ロック　×　前向き
        ライラック
        // 悲しい　×　ロック　×　深いメッセ
        我逢人
        // 悲しい　×　ロック　×　恋愛
        何を何を
        // 悲しい　×　ロック　×　感動
        クスシキ
        // 悲しい　×　ポップ　×　前向き
        マジック
        // 悲しい　×　ポップ　×　深いメッセ
        アンテナ
        // 悲しい　×　ポップ　×　恋愛
        ブルーアンビエンス
        // 悲しい　×　ポップ　×　感動
        安全パイ
        // 悲しい　×　バラード　×　前向き
        どこかで日は昇る
        // 悲しい　×　バラード　×　深いメッセ
        ダーリン
        // 悲しい　×　バラード　×　恋愛
        くだり
        // 悲しい　×　バラード　×　感動
        天国
        // 悲しい　×　EDM　×　前向き
        JOURNEY
        // 悲しい　×　EDM　×　深いメッセ
        スピーキング
        // 悲しい　×　EDM　×　恋愛
        スイッチ
        // 悲しい　×　EDM　×　感動
        つきましては
    };

    // 最初の質問を表示
    function showCurrentQuestion() {
        questions.forEach((q, index) => {
            q.style.display = (index === currentQuestionIndex) ? 'block' : 'none';
        });
    }

    // 回答ボタンのイベントリスナー
    quizSection.querySelectorAll('.answer-btn').forEach(button => {
        button.addEventListener('click', (event) => {
            const questionId = questions[currentQuestionIndex].id;
            const answerValue = event.target.dataset.value;
            answers[questionId] = answerValue; // 回答を保存

            currentQuestionIndex++; // 次の質問へ

            if (currentQuestionIndex < questions.length) {
                showCurrentQuestion(); // 次の質問があれば表示
            } else {
                displayResult(); // 全ての質問に答え終わったら結果表示
            }
        });
    });

    // 結果表示関数
    function displayResult() {
        quizSection.style.display = 'none'; // 質問セクションを非表示
        resultSection.style.display = 'block'; // 結果セクションを表示

        let key = "";
        // 回答を組み合わせてキーを生成
        if (answers.question1 && answers.question2 && answers.question3) {
            key = `${answers.question1}_${answers.question2}_${answers.question3}`;
        }
        
        // 該当する推薦曲がなければデフォルトを表示
        const recommendation = recommendations[key] || recommendations["default"];

        songTitle.textContent = recommendation.title;
        songDescription.textContent = recommendation.description;

        // YouTube埋め込み iframe を生成
        songLinkContainer.innerHTML = `
            <iframe width="100%" height="315" 
                    src="${recommendation.embed_url}" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    referrerpolicy="strict-origin-when-cross-origin" 
                    allowfullscreen>
            </iframe>
        `;
    }

    // 最初は最初の質問を表示
    showCurrentQuestion();

    // もう一度診断するボタン
    restartBtn.addEventListener('click', () => {
        currentQuestionIndex = 0;
        answers = {};
        quizSection.style.display = 'block';
        resultSection.style.display = 'none';
        showCurrentQuestion(); // 最初の質問に戻る
    });
});